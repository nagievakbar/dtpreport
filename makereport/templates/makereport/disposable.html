{% extends 'makereport/layout_form_input.html' %}
{% load static %}
{% block title %}
    <title>Одноразовый</title>
{% endblock %}
{% block header %}
    {% include 'makereport/header/left_navbar.html' with disposable="active" %}
{% endblock %}

{% block content %}
    <style>
        .remove_from_user {
            display: none;
        }
    </style>
    <form method="POST" class="material-form-2" enctype="multipart/form-data">{% csrf_token %}
        <input type="number" value="{{ id_image }}" id="id_image" name="id_image" style="display: none"/>
        {#            report id are important for knowing which report to open and where to store#}
        <input type="number" value="{{ id }}" name="id_report" style="display: none"/>
        <div class="accordion-item">
            <div class="accordion-header">
                <span class="accordion-title">Данные</span>
                <img src="{% static '/makereport/img/Polygon.png' %}" alt="polygon" class="polygon">
            </div>
            <div class="inside-content accordion-content">
                <div class="accordion-content-wrapper">
                    <div class="inputs_big">
                        <div class="left-inputs">
                            {{ report_form.report_number }}
                            {{ car_form.brand_text }}
                            {% if car_form.errors.car_number %}
                                <div class="alert alert-danger">
                                    <strong>
                                        {{ car_form.errors.car_number }}
                                    </strong>
                                </div>
                            {% endif %}
                            {{ car_form.car_number }}
                            {% if car_form.errors.release_date %}
                                <div class="alert alert-danger">
                                    <strong>
                                        Введите правильный год
                                    </strong>
                                </div>
                            {% endif %}
                            {{ car_form.release_date }}
                            {{ car_form.owner_address }}
                            {{ report_form.report_date }}
                            {{ report_form.total_report_cost }}
                            {{ car_form.car_owner }}
                            {{ customer_form.name }}
                            {{ customer_form.address }}

                        </div>
                        <div class="divider"></div>
                        <div class="right-inputs">
                            {{ customer_form.type_customer }}
                            <div class="individual">
                                {% if customer_form.errors.passport_number %}
                                    <div class="alert alert-danger">
                                        <strong>
                                            {{ customer_form.errors.passport_number }}
                                        </strong>
                                    </div>
                                {% endif %}
                                {{ customer_form.passport_number }}

                                {% if customer_form.errors.when_passport_issued %}
                                    <div class="alert alert-danger">
                                        <strong>
                                            {{ customer_form.errors.when_passport_issued }}
                                        </strong>
                                    </div>
                                {% endif %}
                                {{ customer_form.when_passport_issued }}
                                {{ customer_form.whom_passport_issued }}
                            </div>
                            <div class="entity">
                                {{ enumeration_form.p_c }}
                                {{ enumeration_form.bank }}
                                {{ enumeration_form.MFO }}
                                {{ enumeration_form.INN }}
                                {{ enumeration_form.OKED }}
                            </div>
                            {{ contract_form.contract_number }}
                            {{ contract_form.contract_date }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container my-4">
            <div class="file-loading">
                {{ disposable_from.pdf_report }}
            </div>
        </div>
        <div class="container my-4">
            <div class="file-loading">
                {{ image_form.image }}
            </div>
        </div>
        <div class="container my-4">
            <div class="file-loading">
                {{ passphoto_form.photo }}
            </div>
        </div>
        <div class="container my-4">
            <div class="file-loading">
                {{ otherphoto_form.photos }}
            </div>
        </div>
        <div class="container my-4">
            <div class="file-loading">
                {{ checks_form.checks }}
            </div>
        </div>
        <div class="almost_latest_block">
            <div class="row last_details_price">
                <div class="col-sm-12">
                    <div class="save-btn-block">

                        <button class="save-btn">Сохранить</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="material-form-2">
            <div class="last_bottom_block col-12">
                <div class="row">
                    <div class="col-lg-3 download_button">
                        <div class="panel_user" id="download_button1">
                            <a href="{% url 'get_mixing' id %}" target="_blank">
                                <button type="button" class="btn panel_button">Посмотреть</button>
                            </a>
                        </div>
                    </div>

                    <div class="col-lg-3">
                        <div class="download_button">
                            {#                            {% if id != 0 and report.pdf_report_additional.name != ''  and  report.pdf_report_additional.name != None %}#}
                            <div class="panel_user" id="download_button7">
                                <a href="{% url 'get_disposable' id %}" target="_blank">
                                    <button type="button" class="btn panel_button">Посмотреть</button>
                                </a>
                            </div>
                            {#                            {% endif %}#}
                        </div>
                    </div>
                    {% if report.pdf_qr_code_company == None and id != 0 %}
                        <div id="company_sign" class="col-lg-3 download_button">
                            <div class="panel_user" id="download_button5">
                                <button class="btn panel_button"
                                        href="#" data-bs-toggle="modal"
                                        data-bs-target="#exampleModal"
                                        id="sign"
                                        sign="{{ report.signed }}"
                                        sign_from='0'
                                        type="button"
                                        data-bs-report="{{ report.report_id }}"
                                        {#                                    pkcs7="{{ report.pdf_report_pkcs7.0 }}"#}
                                        data-bs-whatever="{{ report.pdf_report_base64 }}"> Подписать
                                </button>
                            </div>
                        </div>
                    {% endif %}
                    {% if report.pdf_qr_code_user == None and id != 0 %}
                        <div id="user_sign" class="col-lg-3 download_button">
                            <div class="panel_user" id="download_button6">

                                <button class="btn panel_button"
                                        type="button"
                                        id="sign_boss"
                                        href="#" data-bs-toggle="modal"
                                        data-bs-target="#exampleModal"
                                        sign="{{ report.signed }}"
                                        sign_from='1'
                                        data-bs-report="{{ report.report_id }}"
                                        {#                                    pkcs7="{{ report.pdf_report_pkcs7.0 }}"#}
                                        data-bs-whatever="{{ report.pdf_report_base64 }}"> Подписать
                                </button>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </form>
{% endblock %}
{% block script_file_input %}
    {% include 'makereport/modal/imzo_sign_modal.html' %}
    <script>
        $('.type_customer').change(function () {
            set_entity_or_individual($(this).val());
        });

        function set_entity_or_individual(value) {
            console.log(value);
            if (value == '0') {
                $('.entity').addClass('remove_from_user');
                $('.individual').removeClass('remove_from_user');
            } else {
                $('.individual').addClass('remove_from_user');
                $('.entity').removeClass('remove_from_user');
            }
        }

        $(document).ready(function () {
            const server = "https://e-otsenka.uz";
            set_entity_or_individual($('.type_customer').val())
            $("#disposable_pdf").fileinput({
                'theme': 'fas',
                initialCaption: 'Загрузите PDF файл',
                'allowedFileExtensions': ['pdf'],
                'uploadUrl': '{% url 'pdf_view' %}',
                'overwriteInitial': false,
                'uploadAsync': true,
                'initialPreviewAsData': true,
                'initialPreview': [
                    {% if report.pdf_report %}
                        `${server}{{ disposable.url_pdf_disposable }}`,
                    {% endif %}
                ],
                'initialPreviewConfig': [
                    {
                        url: '{% url 'pdf_delete' %}',
                        key: {{ report.report_id }},
                    },
                ],
                'ajaxSettings': {
                    headers: {
                        'X-CSRFToken': csrftoken,
                    }
                },
                'uploadExtraData': {
                    id: {{ id }},
                },
                'showUpload': true,
                'required': true,
                'ajaxDeleteSettings': {
                    headers: {
                        'X-CSRFToken': csrftoken,
                    }
                }

            });
        });
    </script>
    <script src="{% static '/makereport/js/desktop17.js' %}"></script>


{% endblock %}